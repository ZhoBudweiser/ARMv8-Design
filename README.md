# MyARMv8：系统硬件综合设计



## 文件的构成

本文档包含：

1. 设计报告
2. 模块代码（.v文件）
   1. 头文件：包含各种信号的宏定义
   2. 各种硬件模块
   3. 阶段封装模块：按照流水线各个阶段做的封装
   4. 数据通路封装模块
   5. 顶层封装模块：与分频器、数码管译码器做的封装
3. 测试代码（.tb文件，实际为.v文件）：
   1. 各个流水线阶段的测试代码：用于前期测试，后期大多引脚改变后弃用，但里面保留了测试的信号
   2. 数据通路的测试代码：可以直接使用
   3. 顶层封装的测试代码：使用时确保顶层封装模块中时钟信号直接接入数据通路模块，若使用分频器输出的信号将无法看到预期效果
4. 报告配图：含各个主要模块和数据通路的原理图、开发流程图及其VISIO文件等（.png和.vsdx）



## 报告中测试的指令

报告中也会给出同样的例子，测试时需要将十六进制代码按照大端的方式，以字节的形式填入***inst_rom.data***文件中，数据存储器的内容可以在***data_rom.data***文件中修改

以下给出了指令的汇编形式、按照指令划分的二进制形式、二进制形式和十六进制形式，测试结果可以查阅报告

--------------------------------------------------------------------
运算指令

ADD X2, X1, X0
SUB X5, X4, X3
SUB X5, X3, X4
AND X8, X7, X6
ORR X11, X10, X9
EOR X14, X13, X12
SUBS X5, X4, X3
SUBS X5, X3, X4
LSR X5, X4, #3 
LSL X5, X3, #2

10001011000_00000_000000_00001_00010 //ADD
11001011000_00011_000000_00100_00101 //SUB
11001011000_00100_000000_00011_00101 //SUB
10001010000_00110_000000_00111_01000 //AND
10101010000_01001_000000_01010_01011 //ORR
11001010000_01100_000000_01101_01110 //EOR
11101011000_00011_000000_00100_00101 //SUBS
11101011000_00100_000000_00011_00101 //SUBS
11010011010_00011_000011_00100_00101 //LSR
11010011011_00100_000010_00011_00101 //LSL

10001011000000000000000000100010
11001011000000110000000010000101
11001011000001000000000001100101
10001010000001100000000011101000
10101010000010010000000101001011
11001010000011000000000110101110
11101011000000110000000010000101
11101011000001000000000001100101
11010011010000110000110010000101
11010011011001000000100001100101


8b000022
cb030085
cb040065
8a0600e8
aa09014b
ca0c01ae
eb030085
eb040065
d3430c85
d3640865

------------------------------------------------------------------
立即数运算

ADDI X5, X0, #7
ANDI X6, X1, #7
ORRI X7, X2, #7
SUBI X8. X3, #7
EORI X9, X4, #7

1001000100_000000000111_00000_00101 // ADDI
1001001000_000000000111_00001_00110 // ANDI
1011001000_000000000111_00010_00111 // ORRI
1101000100_000000000111_00011_01000 // SUBI
1101001000_000000000111_00100_01001 // EORI

10010001000000000001110000000101
10010010000000000001110000100110
10110010000000000001110001000111
11010001000000000001110001101000
11010010000000000001110010001001

91001c05
92001c26
b2001c47
d1001c68
d2001c89

---------------------------------------------------------------------
带flag的立即数运算

ADDIS X1, X0, #1
SUBIS X3, X2, #2
ANDIS X5,X4, #3

1011000100_000000000001_00000_00001 // ADDIS
1111000100_000000000010_00010_00011 // SUBIS
1111001000_000000000011_00100_00101 // ANDIS

10110001000000000000010000000001
11110001000000000000100001000011
11110010000000000000110010000101

b1000401
f1000843
f2000c85

----------------------------------------------------------------------
LOAD和STORE

LDUR X2, [X0+8]
STUR X3, [X1+1]

11111000010_000001000_00_00000_00010 // LDUR
11111000000_000000001_00_00001_00011 // STUR

11111000010000001000000000000010
11111000000000000001000000100011

f8400002
f8001023

数据前推

ADD X2, X1, X0
ADD X2, X2, X1
ADD X2, X2, X1
ADD X2, X2, X1

10001011000_00000_000000_00001_00010
10001011000_00001_000000_00010_00010
10001011000_00001_000000_00010_00010
10001011000_00001_000000_00010_00010

10001011000000000000000000100010
10001011000000010000000001000010
10001011000000010000000001000010
10001011000000010000000001000010

8b000022
8b010042
8b010042
8b010042